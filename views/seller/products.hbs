 <title>My Products</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    table img {
      object-fit: cover;
      border-radius: 4px;
    }
    .container {
      max-width: 1200px;
    }
    .edit-form {
      margin-top: 40px;
      padding: 20px;
      border: 1px solid #dee2e6;
      border-radius: 8px;
      background-color: #f8f9fa;
    }
  </style>
</head>
<body class="p-4">

<div class="container">
  <h2 class="mb-4 text-center">My Products</h2>

  <!-- Products Table -->
  {{#if products.length}}
  <table class="table table-bordered table-hover mx-auto">
    <thead class="table-primary">
      <tr>
        <th>#</th>
        <th>Image</th>
        <th>Name</th>
        <th>Category</th>
        <th>Subcategory</th>
        <th>Price</th>
        <th>Stock</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      {{#each products}}
      <tr>
        <td>{{addOne @index}}</td>
        <td>
          {{#if resizedImages.[0]}}
            <img src="/rimage/{{resizedImages.[0]}}" alt="{{name}}" width="100" height="60">
          {{else}}
            <span>No Image</span>
          {{/if}}
        </td>
        <td>{{name}}</td>
        <td>{{category}}</td>
        <td>{{subcategory}}</td>
        <td>{{price}}</td>
        <td>{{stock}}</td>
        <td>
          <button class="btn btn-sm btn-warning mb-1 edit-btn" 
                  data-id="{{_id}}" 
                  data-name="{{name}}" 
                  data-category="{{category}}" 
                  data-subcategory="{{subcategory}}" 
                  data-price="{{price}}" 
                  data-stock="{{stock}}" 
                  data-description="{{description}}">
            Edit
          </button>
          <form action="/seller/delete-product/{{_id}}" method="POST" style="display:inline;">
            <button type="submit" class="btn btn-sm btn-danger" onclick="return confirm('Are you sure?')">Delete</button>
          </form>
        </td>
      </tr>
      {{/each}}
    </tbody>
  </table>
  {{else}}
    <p class="text-muted text-center">You have no products yet.</p>
  {{/if}}

  <!-- Edit Form Below Table -->
  <div id="editFormContainer" class="edit-form d-none">
    <h4>Edit Product</h4>
    <form id="editForm" method="POST" enctype="multipart/form-data">
      <input type="hidden" name="_id" id="editId">
      <div class="mb-3">
        <label class="form-label">Name</label>
        <input type="text" class="form-control" name="name" id="editName" required>
      </div>
      <div class="mb-3">
        <label class="form-label">Category</label>
        <input type="text" class="form-control" name="category" id="editCategory" required>
      </div>
      <div class="mb-3">
        <label class="form-label">Subcategory</label>
        <input type="text" class="form-control" name="subcategory" id="editSubcategory" required>
      </div>
      <div class="mb-3">
        <label class="form-label">Price</label>
        <input type="number" class="form-control" name="price" id="editPrice" required>
      </div>
      <div class="mb-3">
        <label class="form-label">Stock</label>
        <input type="number" class="form-control" name="stock" id="editStock" required>
      </div>
      <div class="mb-3">
        <label class="form-label">Description</label>
        <textarea class="form-control" name="description" id="editDescription" rows="3" required></textarea>
      </div>
      <button type="submit" class="btn btn-success">Update Product</button>
      <button type="button" class="btn btn-secondary" id="cancelEdit">Cancel</button>
    </form>
  </div>
</div>

<script>
  const editButtons = document.querySelectorAll(".edit-btn");
  const editFormContainer = document.getElementById("editFormContainer");
  const editForm = document.getElementById("editForm");
  const cancelEdit = document.getElementById("cancelEdit");

  editButtons.forEach(btn => {
    btn.addEventListener("click", () => {
      editFormContainer.classList.remove("d-none");
      editForm.action = "/seller/edit-product/" + btn.dataset.id;
      document.getElementById("editId").value = btn.dataset.id;
      document.getElementById("editName").value = btn.dataset.name;
      document.getElementById("editCategory").value = btn.dataset.category;
      document.getElementById("editSubcategory").value = btn.dataset.subcategory;
      document.getElementById("editPrice").value = btn.dataset.price;
      document.getElementById("editStock").value = btn.dataset.stock;
      document.getElementById("editDescription").value = btn.dataset.description;

      // Scroll to form
      editFormContainer.scrollIntoView({ behavior: "smooth" });
    });
  });

  cancelEdit.addEventListener("click", () => {
    editFormContainer.classList.add("d-none");
  });
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>